---
title: 堆排序
---

# 堆排序

```js
Array.prototype.heapSort = function () {
	let arr = this.slice(0);

	let len = arr.length;

	function swap(i, j) {
		let temp = arr[i];
		arr[i] = arr[j];
		arr[j] = temp;
	}

	// 类似 shiftDown
	function maxHeapAdjust(start, end) {
		let father = start;
		let son = start * 2 + 1;

		if (son > end) return;

		if (son + 1 <= end && arr[son] < arr[son + 1]) son++;

		if (arr[start] < arr[son]) {
			swap(start, son);

			maxHeapAdjust(son, end);
		}
	}

	// 初始化堆, 类似 buildHeap
	for (var i = Math.floor(arr.length / 2) - 1; i >= 0; i--) {
		maxHeapAdjust(i, arr.length - 1);
	}

	for (var i = len - 1; i > 0; i--) {
		swap(0, i);
		maxHeapAdjust(0, i - 1);
	}

	return arr;
};

var a = [
	3, 5, 3, 0, 8, 6, 1, 5, 8, 6, 2, 4, 9, 4, 7, 0, 1, 8, 9, 7, 3, 1, 2, 5, 9, 7,
	4, 0, 2, 6,
];

console.log(a.heapSort());

```